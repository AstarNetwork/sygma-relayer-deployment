{
   "family": "{{ relayerName }}-{{ relayerId }}-container-{{ appTag }}",
   "containerDefinitions": [ 
      { 
         "name": "{{ relayerName }}-{{ relayerId }}-container-{{ appTag }}",
         "image": "ghcr.io/sygmaprotocol/sygma-relayer:stable",
         "portMappings": [ 
            { 
               "containerPort": 9000,
               "hostPort": 9000,
               "protocol": "tcp"
            },
            { 
               "containerPort": 9001,
               "hostPort": 9001,
               "protocol": "tcp"
           }
         ],
         "essential": true,
         "command": [
         "run",
         "--config=env",
         "--config-url=https://config.develop.buildwithsygma.com/share/",
         "--name=R{{ relayerId }}",
         "--blockstore=/mount/relayer{{ relayerId }}/lvldbdata",
         "--latest=true"
         ],
         "environment": [
           {
               "name": "DD_SERVICE",
               "value": "relayers"
           },
           {
               "name": "SYG_RELAYER_LOGLEVEL",
               "value": "debug"
           }
         ],
         "mountPoints": [
            {
               "sourceVolume": "efs",
               "containerPath": "/mount"
            }
         ],
         "volumesFrom": [],
         "secrets": [ 
            { 
               "name": "SYG_RELAYER_MPCCONFIG_KEY",
               "valueFrom": "arn:aws:ssm:{{ awsRegion }}:{{ awsAccountId }}:parameter/SYG_RELAYER_MPCCONFIG_KEY"
            },
            {
               "name": "SYG_RELAYER_MPCCONFIG_KEYSHAREPATH",
               "valueFrom": "arn:aws:ssm:{{ awsRegion }}:{{ awsAccountId }}:parameter/SYG_RELAYER_MPCCONFIG_KEYSHAREPATH"
            },
            { 
               "name": "SYG_RELAYER_MPCCONFIG_TOPOLOGYCONFIGURATION_ENCRYPTIONKEY",
               "valueFrom": "arn:aws:ssm:{{ awsRegion }}:{{ awsAccountId }}:parameter/SYG_RELAYER_MPCCONFIG_TOPOLOGYCONFIGURATION_ENCRYPTIONKEY"
            },
            {
               "name": "SYG_RELAYER_MPCCONFIG_TOPOLOGYCONFIGURATION_PATH",
               "valueFrom": "arn:aws:ssm:{{ awsRegion }}:{{ awsAccountId }}:parameter/SYG_RELAYER_MPCCONFIG_TOPOLOGYCONFIGURATION_PATH"
            },
            {
               "name": "SYG_RELAYER_MPCCONFIG_TOPOLOGYCONFIGURATION_URL",
               "valueFrom": "arn:aws:ssm:{{ awsRegion }}:{{ awsAccountId }}:parameter/SYG_RELAYER_MPCCONFIG_TOPOLOGYCONFIGURATION_URL"
            },
            {
              "name": "SYG_CHAINS",
              "valueFrom": "arn:aws:ssm:{{ awsRegion }}:{{ awsAccountId }}:parameter/SYG_CHAINS"
            }
         ],
         "dependsOn": [
            {
               "containerName": "log_router",
               "condition": "START"
            }
         ]
      },
      "healthCheck": {
        "retries": 3,
        "command": ["CMD-SHELL","agent health"],
        "timeout": 5,
        "interval": 30,
        "startPeriod": 15
      },
      "portMappings": [
        {
          "hostPort": 8126,
          "protocol": "tcp",
          "containerPort": 8126
        }
      ],
      "command": [],
      "cpu": 0,
      "environment": [
        {
          "name": "DD_APM_ENABLED",
          "value": "true"
        },
        {
          "name": "DD_APM_NON_LOCAL_TRAFFIC",
          "value": "true"
        },
        {
          "name": "DD_TAGS",
          "value": "env:TESTNET,project:relayer-{{ relayerId }}"
        },
        {
          "name": "DD_LOG_LEVEL",
          "value": "INFO"
        },
        {
          "name": "ECS_FARGATE",
          "value": "true"
        },
        {
          "name": "ENV",
          "value": "TESTNET"
        }
      ],
      "mountPoints": [],
      "volumesFrom": []
    },
    {
      "name": "log_router",
      "image": "amazon/aws-for-fluent-bit:latest",
      "essential": true,
      "firelensConfiguration": {
        "type": "fluentbit",
        "options": {
            "enable-ecs-log-metadata": "true"
        }
      },
      "logConfiguration": { 
            "logDriver": "awslogs",
            "options": { 
               "awslogs-group": "/ecs/{{ relayerName }}-{{ relayerId }}-{{ appTag }}",
               "awslogs-region": "{{ awsRegion }}",
               "awslogs-stream-prefix": "ecs"
            }
         },
         "portMappings": [],
         "command": [],
         "cpu": 0,
         "environment": [],
         "mountPoints": [],
         "user": "0",
         "volumesFrom": []
      }
   ],
    "executionRoleArn": "arn:aws:iam::{{ awsAccountId }}:role/{{ relayerName }}-{{ relayerId }}-ecsTaskExecutionRole",
    "networkMode": "awsvpc",
    "volumes": [
      {
         "name": "efs",
         "efsVolumeConfiguration": {
            "fileSystemId": "fs-0c297f99289117101",
            "rootDirectory": "/",
            "transitEncryption": "ENABLED"
         }
      }
   ],    
   "requiresCompatibilities": [ 
      "FARGATE" 
   ],
   "cpu": "1024",
   "memory": "2048",
   "runtimePlatform": {
      "operatingSystemFamily": "LINUX"
   }
}
